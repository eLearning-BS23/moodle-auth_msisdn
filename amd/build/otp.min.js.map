{"version":3,"sources":["../src/otp.js"],"names":["define","$","Ajax","Notification","click","withotcode","val","phone","test","timer","remaining","m","Math","floor","s","document","getElementById","innerHTML","timerOn","setTimeout","alert","removeAttr","call","methodname","args","done","data","warnings","length","removeClass","attr","addNotification","message","type","fail","exception","e","console","log"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     auth_otp/otp\n * @copyright  2021 Brain station 23 <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function ($, Ajax, Notification) {\n\n    $(\"#sendotp\").click(function () {\n        var withotcode = $('#phone').val();\n        // var phone = $('.iti__selected-dial-code').html() + $('#phone').val();\n        // phone = phone.replace(\"+\", '');\n        // alert(phone);\n        var phone = $('#phone').val();\n        // ;\n        if (phone) {\n            var phoneno = /^\\d{10}$/;\n            if (phoneno.test(phone)) {\n\n                let timerOn = true;\n\n                function timer(remaining) {\n                    var m = Math.floor(remaining / 60);\n                    var s = remaining % 60;\n                    m = m < 10 ? '0' + m : m;\n                    s = s < 10 ? '0' + s : s;\n                    document.getElementById('timer').innerHTML = m + ':' + s;\n                    remaining -= 1;\n                    if (remaining >= 0 && timerOn) {\n                        setTimeout(function () {\n                            timer(remaining);\n                        }, 1000);\n                        return;\n                    }\n                    if (!timerOn) {\n                        // Do validate stuff here\n                        return;\n                    }\n                    // Do timeout stuff here\n                    alert('Timeout for otp');\n                    $('#sendotp').removeAttr('disabled');\n                    document.getElementById('timer').innerHTML = 'Resend Code';\n                }\n                // API Call\n                var wsfunction = 'auth_otp_send_sms';\n                var params = {\n                    'phone': phone,\n                };\n\n                var request = {\n                    methodname: wsfunction,\n                    args: params\n                };\n\n                try {\n                    Ajax.call([request])[0].done(function (data) {\n                        if (data.warnings.length < 1) {\n                            $('#otp-field').removeClass('d-none');\n                            $('#sendotp').attr('disabled', 'disabled');\n                            $('#phone').attr('disabled', 'disabled');\n                            $('#username').val(phone);\n                            timer(300);\n\n                            Notification.addNotification({\n                                message: data.message,\n                                type: 'error'\n                            });\n\n                        } else {\n                            Notification.addNotification({\n                                message: 'Something went wrong to send otp Please Try again !!',\n                                type: 'error'\n                            });\n                        }\n                    }).fail(Notification.exception);\n                } catch (e) {\n                    console.log(e);\n                }\n            } else {\n                Notification.addNotification({\n                    message: 'insert Valid Phone number !!',\n                    type: 'error'\n                });\n            }\n        } else {\n            Notification.addNotification({\n                message: 'phone number can\\'t be empty',\n                type: 'error'\n            });\n\n        }\n        return false;\n    });\n});"],"file":"otp.min.js"}